"use strict";
Object.defineProperty(exports, "__esModule", { value: true });
const devkit_1 = require("@nx/devkit");
const packages = [
    'webpack',
    'copy-webpack-plugin',
    'webpack-merge',
    'webpack-node-externals',
    'mini-css-extract-plugin',
    'source-map-loader',
    'terser-webpack-plugin',
    'webpack-dev-server',
    'webpack-sources',
    'react-refresh',
    '@pmmmwh/react-refresh-webpack-plugin',
];
async function update(tree) {
    const packageJson = (0, devkit_1.readJson)(tree, 'package.json');
    let task = undefined;
    // Undo the install by `nx g @nrwl/web:webpack5` in Nx 12.
    if (packageJson.devDependencies['webpack']?.match(/^([\^~])?5\./) &&
        packages.every((p) => packageJson.devDependencies[p])) {
        task = (0, devkit_1.removeDependenciesFromPackageJson)(tree, [], packages);
        await (0, devkit_1.formatFiles)(tree);
    }
    return task;
}
exports.default = update;
